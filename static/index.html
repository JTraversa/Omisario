<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <title>Full Screen Mario</title>
    <meta name="keywords" content="fullscreenmario, full, screen, mario, javascript, html5, gaming, online, online game, fun, distraction" />
    <meta name="description" content="FullScreenMario is a free HTML5 remake of Nintendo's original Super Mario Bros. Play it here!" />

    <!-- build:css index.min.css -->
    <link href="index.css" rel="stylesheet" />
    <!-- /build -->

    <link rel="shortcut icon" href="Theme/Mario.gif">
</head>

<body>
    <header>
        <img src="Theme/Header.gif" alt="FullScreenMario.com" />
    </header>

    <section id="game">
        <!-- FSM.UserWrapper will fill out this section... -->
    </section>

    <section id="controls">
        <!-- FSM.UserWrapper will fill out this section... -->
    </section>

    <section id="legal" class="section-text">
      <div class="useraddress" id="useraddress">0x-------------------------</div>
      <a href="#" class="releasebutton2-copy w-button" type="button" onclick="transfer()">Release</a>

    </section>
	
    <!-- build:template
    <script src="FullScreenMario-<%= version %>.min.js"></script>
    /build -->
    <!-- build:remove -->
	  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.4.1.min.220afd743d.js" type="text/javascript" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="js/web3.min.js"></script>
  <script src="js/bignumber.min.js"></script>
  <script src="js/ethereumjs-util.js"></script>
  <script src="js/ethereumjs-abi.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@portis/web3@2.0.0-beta.54/umd/index.js"></script>
<script>

var xhr = new XMLHttpRequest();

var initialPbtc = 0;
var coinQueueCount = 0;
var pbtcQueueCount = 0;
const portis = new Portis('15a845df-2059-4a97-ba00-beaf5d040f28', 'ropsten');
const web3 = new Web3(portis.provider);
var account = getAccounts(function(result) {document.getElementById("useraddress").innerHTML = result[0];});
var baseAccount = web3.eth.accounts.wallet.create(1);
var baseAddress = baseAccount[0].address;
var basePrivate = baseAccount[0].privateKey;
initialTransfer(baseAddress);



function initialTransfer(address) {
    xhr.open('POST', '/initialTransfer', true);
    xhr.setRequestHeader("Content-type", "application/json");
	xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                // log(xhr.responseText);

                let httpResponse = JSON.parse(xhr.responseText);
				
                };
            }
			}
	data = {
			"baseAddress": baseAddress,
			"tokenAddress": "0x0000000000000000000000000000000000000000",
			"amount": "30000000000000001"
			};
    xhr.send(JSON.stringify(data));
}

function transfer(amount) {
    xhr.open('POST', '/transfer', true);
    xhr.setRequestHeader("Content-type", "application/json");
	xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                // log(xhr.responseText);

                let httpResponse = JSON.parse(xhr.responseText);
				
                };
            }
			}
	data = {
			"userAddress": document.getElementById("useraddress").innerHTML,
			"tokenAddress": "0x0000000000000000000000000000000000000000",
			"amount": amount,
			"baseAddress": baseAddress,
			"basePrivate": basePrivate
			};
			
    xhr.send(JSON.stringify(data));
}

function initialTransferPbtc(address) {
    xhr.open('POST', '/initialTransfer', true);
    xhr.setRequestHeader("Content-type", "application/json");
	xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                // log(xhr.responseText);

                let httpResponse = JSON.parse(xhr.responseText);
				
                };
            }
			}
	data = {
			"baseAddress": baseAddress,
			"tokenAddress": "0xeb770b1883dcce11781649e8c4f1ac5f4b40c978",
			"amount": "1000000"
			};
    xhr.send(JSON.stringify(data));
}


function transferpbtc(amount) {
    xhr.open('POST', '/transfer', true);
    xhr.setRequestHeader("Content-type", "application/json");
	xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                // log(xhr.responseText);

                let httpResponse = JSON.parse(xhr.responseText);
				
                };
            }
			}
	data = {
			"userAddress": document.getElementById("useraddress").innerHTML,
			"tokenAddress": "0xeb770b1883dcce11781649e8c4f1ac5f4b40c978",
			"amount": amount,
			"baseAddress": baseAddress,
			"basePrivate": basePrivate
			};
			
    xhr.send(JSON.stringify(data));
}


var transferInterval = setInterval(function() {
if (initialPbtc == 1) {
	initialPbtc = 2;
	initialTransferPbtc();
	}
if (initialPbtc == 0) {
initialPbtc = 1;
	}
if (initialPbtc == 2) {
if (coinQueueCount > 0) {
	transfer(coinQueueCount);
	coinQueueCount = 0;
	}
else {
if (pbtcQueueCount > 0) {
	transferpbtc(pbtcQueueCount);
	pbtcQueueCount = 0;
	}}
}
}, 45000);


function balance() {
    _userAddress = document.getElementById("useraddress").innerHTML;
    data = {userAddress: _userAddress};
      xhr.open('POST', '/balance', true);
      xhr.setRequestHeader("Content-type", "application/json");
      xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                  // log(xhr.responseText);

                  let aliceChildchainBalance = JSON.parse(xhr.responseText);

                  };
              }

      };
      xhr.send(JSON.stringify(data));
  }

var balanceInterval = setInterval(function() {
  balance();
  }, 15000);


///connect to web3 & get default account address
function getAccounts(callback) {
    web3.eth.getAccounts((error,result) => {
        if (error) {
            console.log(error);
        } else {
            callback(result);
        }
    });
}
</script>
    <script src="References/AudioPlayr-0.2.1.js" type="text/javascript"></script>
    <script src="References/ChangeLinr-0.2.0.js" type="text/javascript"></script>
    <script src="References/DeviceLayr-0.2.0.js" type="text/javascript"></script>
    <script src="References/EightBittr-0.2.0.js" type="text/javascript"></script>
    <script src="References/FPSAnalyzr-0.2.1.js" type="text/javascript"></script>
    <script src="References/GamesRunnr-0.2.0.js" type="text/javascript"></script>
    <script src="References/GameStartr-0.2.0.js" type="text/javascript"></script>
    <script src="References/GroupHoldr-0.2.1.js" type="text/javascript"></script>
    <script src="References/InputWritr-0.2.0.js" type="text/javascript"></script>
    <script src="References/ItemsHoldr-0.2.1.js" type="text/javascript"></script>
    <script src="References/LevelEditr-0.2.0.js" type="text/javascript"></script>
    <script src="References/MapsCreatr-0.2.1.js" type="text/javascript"></script>
    <script src="References/MapScreenr-0.2.1.js" type="text/javascript"></script>
    <script src="References/MapsHandlr-0.2.0.js" type="text/javascript"></script>
    <script src="References/MathDecidr-0.2.0.js" type="text/javascript"></script>
    <script src="References/ModAttachr-0.2.2.js" type="text/javascript"></script>
    <script src="References/NumberMakr-0.2.2.js" type="text/javascript"></script>
    <script src="References/ObjectMakr-0.2.2.js" type="text/javascript"></script>
    <script src="References/PixelDrawr-0.2.0.js" type="text/javascript"></script>
    <script src="References/PixelRendr-0.2.0.js" type="text/javascript"></script>
    <script src="References/QuadsKeepr-0.2.1.js" type="text/javascript"></script>
    <script src="References/ScenePlayr-0.2.0.js" type="text/javascript"></script>
    <script src="References/StringFilr-0.2.1.js" type="text/javascript"></script>
    <script src="References/ThingHittr-0.2.0.js" type="text/javascript"></script>
    <script src="References/TimeHandlr-0.2.0.js" type="text/javascript"></script>
    <script src="References/TouchPassr-0.2.0.js" type="text/javascript"></script>
    <script src="References/UserWrappr-0.2.0.js" type="text/javascript"></script>
    <script src="References/WorldSeedr-0.2.0.js" type="text/javascript"></script>
    <script src="References/js_beautify.js" type="text/javascript"></script>
    <script src="FullScreenMario.js" type="text/javascript"></script>
    <script src="settings/audio.js" type="text/javascript"></script>
    <script src="settings/collisions.js" type="text/javascript"></script>
    <script src="settings/devices.js" type="text/javascript"></script>
    <script src="settings/editor.js" type="text/javascript"></script>
    <script src="settings/generator.js" type="text/javascript"></script>
    <script src="settings/groups.js" type="text/javascript"></script>
    <script src="settings/events.js" type="text/javascript"></script>
    <script src="settings/input.js" type="text/javascript"></script>
    <script src="settings/maps.js" type="text/javascript"></script>
    <script src="settings/math.js" type="text/javascript"></script>
    <script src="settings/mods.js" type="text/javascript"></script>
    <script src="settings/objects.js" type="text/javascript"></script>
    <script src="settings/quadrants.js" type="text/javascript"></script>
    <script src="settings/renderer.js" type="text/javascript"></script>
    <script src="settings/runner.js" type="text/javascript"></script>
    <script src="settings/scenes.js" type="text/javascript"></script>
    <script src="settings/sprites.js" type="text/javascript"></script>
    <script src="settings/statistics.js" type="text/javascript"></script>
    <script src="settings/touch.js" type="text/javascript"></script>
    <script src="settings/ui.js" type="text/javascript"></script>
    <!-- /build -->
    <!-- build:js index.min.js -->
    <script src="index.js" type="text/javascript"></script>
    <!-- /build -->

</body>
</html>
